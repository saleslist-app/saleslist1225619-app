<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Saleslist App</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 30px;
    }
    h1 {
      color: #333;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: left;
    }
    input[type="text"] {
      width: 200px;
      padding: 5px;
      margin-bottom: 10px;
    }
    .history {
      font-size: 0.8em;
      color: #666;
    }
  </style>
</head>
<body>
  <h1>会社リスト</h1>

  <!-- CSVアップロード -->
  <input type="file" id="csvFileInput" accept=".csv" />

  <!-- 検索 -->
  <input type="text" id="searchInput" placeholder="検索...">

  <!-- 会社テーブル -->
  <table id="companyTable">
    <thead>
      <tr>
        <th>会社名</th>
        <th>電話番号</th>
        <th>住所</th>
        <th>代表者名</th>
        <th>備考</th>
        <th>履歴</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const tableBody = document.querySelector("#companyTable tbody");
    const searchInput = document.getElementById("searchInput");

    let companyData = [];

    document.getElementById("csvFileInput").addEventListener("change", function(e) {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = function(e) {
        const lines = e.target.result.split("\n").filter(Boolean);
        const headers = lines[0].split(",");
        companyData = lines.slice(1).map(line => {
          const values = line.split(",");
          return {
            name: values[0],
            phone: values[1],
            address: values[2],
            ceo: values[3],
            memo: values[4],
            history: []
          };
        });
        renderTable();
      };
      reader.readAsText(file);
    });

    function renderTable(filter = "") {
      tableBody.innerHTML = "";
      companyData.forEach((company, index) => {
        if (
          company.name.includes(filter) ||
          company.phone.includes(filter) ||
          company.address.includes(filter) ||
          company.ceo.includes(filter) ||
          company.memo.includes(filter)
        ) {
          const row = tableBody.insertRow();

          row.innerHTML = `
            <td><input type="text" value="${company.name}" onchange="updateCell(${index}, 'name', this.value)"></td>
            <td><input type="text" value="${company.phone}" onchange="updateCell(${index}, 'phone', this.value)"></td>
            <td><input type="text" value="${company.address}" onchange="updateCell(${index}, 'address', this.value)"></td>
            <td><input type="text" value="${company.ceo}" onchange="updateCell(${index}, 'ceo', this.value)"></td>
            <td><input type="text" value="${company.memo}" onchange="updateCell(${index}, 'memo', this.value)"></td>
            <td class="history">${company.history.join("<br>")}</td>
            <td>
              <button onclick="addHistory(${index})">履歴追加</button>
              <button onclick="deleteCompany(${index})">削除</button>
            </td>
          `;
        }
      });
    }

    function updateCell(index, key, value) {
      companyData[index][key] = value;
    }

    function addHistory(index) {
      const memo = prompt("通話履歴メモを入力:");
      if (memo) {
        const now = new Date().toLocaleString();
        companyData[index].history.push(`[${now}] ${memo}`);
        renderTable(searchInput.value);
      }
    }

    function deleteCompany(index) {
      if (confirm("本当に削除しますか？")) {
        companyData.splice(index, 1);
        renderTable(searchInput.value);
      }
    }

    searchInput.addEventListener("input", function() {
      renderTable(this.value);
    });
  </script>
</body>
</html>
